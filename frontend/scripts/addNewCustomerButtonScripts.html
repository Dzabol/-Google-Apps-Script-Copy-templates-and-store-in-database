<script>
  /**
      *********************************************************************
                                 EVENT LISTENERS
      *********************************************************************
     */
  document
    .getElementById("Submit-button")
    .addEventListener("click", afterButtonSubmitInAddNewCustomer);

  document
    .getElementById("cancelAddNewCustomer-button")
    .addEventListener("click", exitFromWindowAddNewCustomer);

  document
    .getElementById("applyAddNewCustomer-button")
    .addEventListener("click", submitNewCustomer);

  document
    .getElementById("exitAddNewCustomer-button")
    .addEventListener("click", exitFromWindowAddNewCustomer);

  /* ------------------------------------------------------------------------------------------ */

  function afterButtonAddCustomerSubmitOnMainPage(e) {
    e.preventDefault();
    document
      .getElementById("addNewCustomerWindow")
      .classList.remove("hide-window");
  }
  /* ------------------------------------------------------------------------------------------ */

  async function submitNewCustomer(e) {
    e.preventDefault();
    runOrCloseLoaderWindow(true);
    const customerNameFromInputBox = websiteElements.newCustomerInputBox.value;
    if (!validateNewCustomerinputBox(customerNameFromInputBox)) {
      return;
    }

    const newCustomerName = createCorrectNameOfTheCustomer(
      customerNameFromInputBox
    );
    try {
      await runGoogleScriptWithPromises(
        "addNewCustomerToDataBase",
        newCustomerName
      );
      websiteElements.newCustomerAllertWindow.textContent = `New Customer: ${newCustomerName} has been added to the data base`;
      clearInputBox("addNewCustomerWindow");
      clearAlerts(websiteElements.newCustomerAllertWindow, 3000);
    } catch (error) {
      websiteElements.newCustomerAllertWindow.textContent = `Can't add new customer ${error}`;
    }
    runOrCloseLoaderWindow(false);
  }

  /* ------------------------------------------------------------------------------------------ */

  function createCorrectNameOfTheCustomer(inputText) {
    let temporaryText = inputText.toString().trim();
    return (correctName =
      temporaryText.slice(0, 1).toUpperCase() + temporaryText.slice(1));
  }
  /* ------------------------------------------------------------------------------------------ */

  function validateNewCustomerinputBox() {
    let fieldsToCheck = document
      .getElementById("addNewCustomerWindow")
      .querySelectorAll("[required]");

    let invalidFields = Array.from(fieldsToCheck).filter(function (element) {
      element.classList.remove("is-invalid");
      return !element.value;
    });

    invalidFields.forEach(function (element) {
      element.classList.add("is-invalid");
    });

    if (invalidFields.length) return false;

    return true;
  }
  /* ------------------------------------------------------------------------------------------ */

  function clearInvalidObject(sectionNameToRemoveValidation) {
    let fieldsToRemoveValidation = document
      .getElementById(sectionNameToRemoveValidation)
      .querySelectorAll("[required]");

    fieldsToRemoveValidation.forEach(function (element) {
      element.classList.remove("is-invalid");
    });
  }

  /* ------------------------------------------------------------------------------------------ */

  function exitFromWindowAddNewCustomer(e) {
    e.preventDefault();

    clearInvalidObject("addNewCustomerWindow");
    document
      .getElementById("addNewCustomerWindow")
      .classList.add("hide-window");
  }
  /* ------------------------------------------------------------------------------------------ */

  function afterButtonSubmitInAddNewCustomer(e) {
    if (submitNewCustomer(e)) {
      clearInputBox("addNewCustomerWindow");
      setTimeout(() => {
        exitFromWindowAddNewCustomer(e);
      }, 4000);
    }
  }
  /* ------------------------------------------------------------------------------------------ */

  function afterButtonApplyInAddNewCustomer(e) {
    if (submitNewCustomer(e)) {
      clearInputBox("addNewCustomerWindow");
    }
  }
  /* ------------------------------------------------------------------------------------------ */

  function addNewCustomerTotheDatabase() {
    websiteElements.newCustomerAllertWindow.textContent = newCustomerName;
  }
</script>
