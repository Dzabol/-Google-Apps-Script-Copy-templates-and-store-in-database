<script>
  /* ------------------------------------------------------------------*/
  async function getServerAccesInformationForTheUser() {
    websiteElements.alertsWindow.textContent =
      "Please wait, loading server access information...";
    try {
      serverAccesInformation = await runGoogleScriptWithPromises(
        "serversAccesInformation"
      );

      websiteElements.alertsWindow.textContent =
        "Server information successfully loaded";

      populateServersAcces_Led(serverAccesInformation);
      allFoldersAccessRights = await runGoogleScriptWithPromises(
        "checkIfOtherFunctionsCanBeRun",
        serverAccesInformation
      );

      if (!allFoldersAccessRights) {
        websiteElements.alertsWindow.textContent =
          "You can't add new project to the database because you don't have an read/write rights to all servers";
      }
    } catch (error) {
      "Can't load server information" + "\n\n" + error;
    }
  }

  /* ------------------------------------------------------------------*/
  async function populateServersAcces_Led(serversInformation) {
    let numberOfServers = serversInformation.length;
    let serversSectionTemplateName = "ledBox-template";
    let sectionNameInHTMLToSetTemplate = "servers-box";

    let sectionToInsertTemplate = document.getElementById(
      sectionNameInHTMLToSetTemplate
    );

    const templateFromHTML = document.getElementById(
      serversSectionTemplateName
    ).content;

    serversInformation.forEach((server, index) => {
      let copyOfTemplate = document.importNode(templateFromHTML, true);
      copyOfTemplate.querySelector(".server-title").textContent =
        serversInformation[index].serverName;

      let serverFileClass = copyOfTemplate.querySelector(".serverFiles");
      let templateFilesClass = copyOfTemplate.querySelector(".templateFiles");

      let projectsLed = serverFileClass.querySelector(".led");
      let templatesLed = templateFilesClass.querySelector(".led");

      if (serversInformation[index].sourceFolder == true) {
        projectsLed.className = "led-green";
      } else {
        projectsLed.className = "led-red";
      }
      if (serversInformation[index].targetFolder == true) {
        templatesLed.className = "led-green";
      } else {
        templatesLed.className = "led-red";
      }

      let serversIDs = [];
      runGoogleScriptWithPromises("transferServersInformationToHTML").then(
        (object) => {
          serversIDs = object;

          setUrlToRequiredSection(
            serversIDs[index].sourceFolderUrl,
            templateFilesClass,
            ".serverWithTemplatesDescription",
            "Template Folder"
          );

          setUrlToRequiredSection(
            serversIDs[index].targetFolderUrl,
            serverFileClass,
            ".serverWithFilesDescription",
            "Projects Folder"
          );
        }
      );

      sectionToInsertTemplate.appendChild(copyOfTemplate);
    });
  }

  function setUrlToRequiredSection(
    folderUrl,
    serverFileClass,
    className,
    urlDescription
  ) {
    let el = serverFileClass.querySelector("" + className + "");
    if (el) {
      el.innerHTML = `<a href="${folderUrl}" target="_blank">${urlDescription}</a>`;
    } else {
      console.error("Element not found!");
    }
  }
</script>
