<script>
  async function pageLoad() {
    try {
      runOrCloseLoaderWindow(true);
      await Promise.all([
        loadUserInformation(),
        checkAccessRights(),
        loadDatabaseInformation(),
      ]);

      if (allFoldersAccessRights) {
        await loadProjectsAndCustomers();
      } else {
        websiteElements.alertsWindow.textContent =
          "You can't add new project to the database because you don't have an read/write rights to all servers";
      }
    } catch (error) {
      websiteElements.alertsWindow.textContent = error;
      errors.push(error);
      numberOfErrors += 1;
    }

    if (numberOfErrors == 0 && allFoldersAccessRights) {
      clearAlerts(websiteElements.alertsWindow);
    }
    if (numberOfErrors != 0) {
      console.log("error: " + numberOfErrors);
      let errorMessage =
        "Please contact with Sebastian Jablecki because there is something wrong with the aplication";
      window.alert(errorMessage);
      console.log(errors);
    }

    await runOrCloseLoaderWindow(false);
    console.log(customerList);
  }

  /****************************************************************************************************/

  async function loadUserInformation() {
    return await runGoogleScriptWithPromises("getActiveUserInformation").then(
      (object) => {
        userInformation = object;
        websiteElements.userEmailWindow.textContent = `welcome: ${userInformation.email}`;
      }
    );
  }

  async function loadDatabaseInformation() {
    return await runGoogleScriptWithPromises(
      "googleDataBaseAccesInformation"
    ).then((object) => {
      sheetDataBaseInformation = object;
      return getServerAccesInformationForTheUserAndLoadLeds(object);
    });
  }

  async function checkAccessRights() {
    return (allFoldersAccessRights = await runGoogleScriptWithPromises(
      "checkIfOtherFunctionsCanBeRun",
      serverAccesInformation
    ));
  }

  async function loadProjectsAndCustomers() {
    projectsInformations = await runGoogleScriptWithPromises(
      "getProjectsInformation"
    );

    customerList = await runGoogleScriptWithPromises(
      "getListOfTheAllCustomers"
    );

    return populateDropDownCustomerList(customerList);
  }
</script>
